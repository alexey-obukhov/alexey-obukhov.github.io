<!DOCTYPE html>
<html>
<head>
  <!-- AR.js by @jerome_etienne - github: https://github.com/jeromeetienne/ar.js - info: https://medium.com/arjs/augmented-reality-in-10-lines-of-html-4e193ea9fdbf -->
  <script src="https://aframe.io/releases/0.6.0/aframe.min.js"></script>
  <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/1.5.0/aframe/build/aframe-ar.js"></script>
  <script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v3.8.4/dist/aframe-extras.min.js"></script>
  <script src="https://rawgit.com/mayognaise/aframe-gif-shader/master/dist/aframe-gif-shader.min.js"></script>
  <script>
    AFRAME.registerComponent('vidhandler', {
      init: function () {
        this.vid = document.querySelector("#vid");
        this.toggle = false;
      }
    });
  </script>
  <script>
    AFRAME.registerComponent('rotation-listener', {
      tick: function () {
        var vid = document.querySelector("#vid");
        if (this.el.object3D.visible) {
          vid.setAttribute('material', 'transparent: false; opacity: 1');
          if (!this.toggle) {
            this.toggle = true;
            vid.play();
          }
        } else {
          this.toggle = false;
          vid.pause();
          vid.setAttribute('material', 'transparent: true; opacity: 0');
        }
      }
    });
  </script>
  <script>
    AFRAME.registerComponent('size-adjuster', {
      dependencies: ['marker'],
      init: function () {
        this.el.addEventListener('markerFound', this.adjustSize.bind(this));
        this.el.addEventListener('markerLost', this.resetSize.bind(this));
      },
      adjustSize: function () {
        var marker = this.el.object3D;
        var video = document.querySelector("#vid");
        var videoWidth = window.innerWidth;
        var videoHeight = window.innerHeight;
        var aspectRatio = videoWidth / videoHeight;
        var scale = 1;

        // Adjust the scale based on the video resolution
        if (aspectRatio > 1) {
          scale = 1 / aspectRatio;
        } else {
          scale = aspectRatio;
        }
        this.el.setAttribute('scale', scale + ' ' + scale + ' ' + scale);
      },
      resetSize: function () {
        this.el.setAttribute('scale', '1 1 1'); // Reset scale to 1
      }
    });
  </script>
</head>

<body style='margin : 0px; overflow: hidden;'>
  <div style='position: fixed; top: 10px; width:inherit; text-align: center; z-index: 1;'>
    <a href="https://github.com/jeromeetienne/AR.js/" target="_blank"></a>
  </div>
  <a-scene rotation-listener embedded artoolkit='sourceType: webcam; detectionMode: mono; maxDetectionRate: 30; canvasWidth: 240; canvasHeight: 180'>
    <a-assets>
      <video id="vid" src="assets/asset.mp4" loop="true" autoplay crossorigin></video>
    </a-assets>
    <a-marker id="memarker" preset="hiro" vidhandler>
      <a-plane position='0 0 -5' rotation="-90 0 0" material='opacity:1; src:#vid' size-adjuster></a-plane>
    </a-marker>
  </a-scene>
  <script>
    var marker = document.querySelector("#memarker");
    var video = document.querySelector("#vid");
    marker.addEventListener('markerFound', function() {
      video.play();
    });
    marker.addEventListener('markerLost', function() {
      video.pause();
    });
  </script>
</body>
</html>
